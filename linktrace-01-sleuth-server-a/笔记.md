
#### Sleuth+Zipkin案例演示

1、安装部署zipkin-server
具体安装部署方法见下文

2、引入相关依赖
在每个微服务引入如下依赖：
```xml
<!-- 老版本的spring-cloud中引入的是 spring-cloud-starter-zipkin-->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-sleuth-zipkin</artifactId>
</dependency>

<!-- 在服务工程中引入sleuth依赖 -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-sleuth</artifactId>
</dependency>
```

需要注意的是：对于老版本spring-cloud对于zipkin依赖是引入如下依赖：
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-zipkin</artifactId>
</dependency>
```

3、进行相关配置
在每个微服务新增如下关于Sleuth+Zipkin的配置, 这是基本的配置，Sleuth+Zipkin还有很多其它配置，
根据实际项目需求进行配置即可。
```properties
# zipkin的服务器地址
spring.zipkin.base-url=http://localhost:9411/
#sleuth配置:配置采样率  默认的采样比例为: 0.1，即 10%，所设置的值介于 0 到 1 之间，1 则表示全部采集
spring.sleuth.sampler.probability=1
#为了使用速率限制采样器,选择每秒间隔接受的trace量，最小数字为0，最大值为2,147,483,647（最大int） 默认为10。
spring.sleuth.sampler.rate=20
```



#### zipkin-server安装部署
1、下载
下载地址：https://repo1.maven.org/maven2/io/zipkin/zipkin-server/
版本选择你需要的版本下载即可,我这里选择的是2.24.0版本

2、启动
`
切换至下载目录。执行如下命令启动
```shell script
java -jar zipkin-server-2.24.0-exec.jar &
```

3、登录
http://localhost:9411/zipkin